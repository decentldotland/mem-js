(function(s,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],n):(s=typeof globalThis<"u"?globalThis:s||self,n(s["react-mem-api"]={},s.React))})(this,function(s,n){"use strict";var F=Object.defineProperty;var x=(s,n,d)=>n in s?F(s,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[n]=d;var w=(s,n,d)=>(x(s,typeof n!="symbol"?n+"":n,d),d);const d="https://mem-api.com/state/",M="https://mem-api.com/transactions/",I="https://mem-testnet-bfdc8ff3530f.herokuapp.com/",f={async get(c,t={}){try{const e=await fetch(c,{method:"GET",headers:(t==null?void 0:t.headers)||{}});return{data:await e.json(),status:e.status,statusText:e.statusText,headers:e.headers,config:t}}catch(e){throw e}},async post(c,t={},e={}){try{const o=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",...e.headers},body:JSON.stringify(t)});return{data:await o.json(),status:o.status,statusText:o.statusText,headers:o.headers,config:e}}catch(o){throw o}}};class m{constructor(t){w(this,"functionId","");w(this,"state",{});w(this,"loaders",{isReadLoading:null,isWriteLoading:null});t?(this.functionId=t,this.read(t)):console.warn("No functionId provided, set it via setFunctionId")}setFunctionId(t){this.functionId=t}_isFunctionId(){if(!this.functionId)throw new Error("functionId is not initialized.")}async read(t){try{let e=t||this.functionId;t||this._isFunctionId();const o=(await f.get(d+e)).data;return this.state=o,o}catch(e){console.log(e);return}}async write(t,e){try{let o=e||this.functionId;e||this._isFunctionId();const l={functionId:o,inputs:t},u=(await f.post(M,l)).data,y=u.data.execution.state;return this.state=y,u}catch(o){console.log(o);return}}async testnet(t=0,e,o,l){try{return(await f.post(I,{contractType:t,initState:e,input:o,contractSrc:l})).data}catch(u){console.log(u);return}}}const T=n.createContext({});function g(c){const t=n.useRef();return n.useEffect(()=>{t.current=c},[c]),t.current}function R(c){const t=n.useContext(T),[e,o]=n.useState(c||""),l=g(c||e),[u,y]=n.useState({}),S=t[e];if(!t[e]){const i=new m(e);t[e]=i}n.useEffect(()=>{e&&l!==e?v(e):console.warn("No functionId provided, set it via setFunctionId")},[e]),n.useEffect(()=>{JSON.stringify(u).length>=750*1048576&&console.warn("State size over 750 KB")},[u]),n.useEffect(()=>{Object.keys(t).length>=10&&console.warn("Instantiated 10 functions -- might decrease performance")},[t]);function E(i,r,a){if(!t[a])return;t[a].loaders[i]=r;const h=new CustomEvent("loadStatus",{detail:{functionId:a,loaders:t[a].loaders}});window.dispatchEvent(h)}const _=()=>{if(!e)throw new Error("functionId is not initialized.")},v=async i=>{try{let r=i||e;i||_(),E("isReadLoading",!0,r);const a=(await f.get(d+r)).data;return E("isReadLoading",!1,r),y(a),a}catch(r){console.log(r);return}};return{currentFunction:S,setFunctionId:o,destroyFunctionId:async i=>{delete t[i]},allFunctions:t,state:u,read:v,write:async(i,r)=>{try{let a=r||e;r||_();const h={functionId:a,inputs:i};E("isWriteLoading",!0,a);const p=(await f.post(M,h)).data;E("isWriteLoading",!1,a);const L=p.data.execution.state;return y(L),p}catch(a){console.log(a);return}},testnet:async(i=0,r,a,h)=>{try{return(await f.post(I,{contractType:i,initState:r,input:a,contractSrc:h})).data}catch(p){console.log(p);return}}}}s.KB=1048576,s.MEM=m,s.MEMContext=T,s.MEM_URL_READ=d,s.MEM_URL_TESTNET=I,s.MEM_URL_WRITE=M,s.axios=f,s.useMEM=R,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
