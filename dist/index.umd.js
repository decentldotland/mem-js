(function(n,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],s):(n=typeof globalThis<"u"?globalThis:n||self,s(n["mem-js"]={},n.React))})(this,function(n,s){"use strict";var F=Object.defineProperty;var j=(n,s,r)=>s in n?F(n,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[s]=r;var I=(n,s,r)=>(j(n,typeof s!="symbol"?s+"":s,r),r);const r="https://mem-api.com/state/",E="https://mem-api.com/transactions/",y="https://mem-testnet-bfdc8ff3530f.herokuapp.com/",l={async get(f,t={}){try{const e=await fetch(f,{method:"GET",headers:(t==null?void 0:t.headers)||{}});return{data:await e.json(),status:e.status,statusText:e.statusText,headers:e.headers,config:t}}catch(e){throw e}},async post(f,t={},e={}){try{const o=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json",...e.headers},body:JSON.stringify(t)});return{data:await o.json(),status:o.status,statusText:o.statusText,headers:o.headers,config:e}}catch(o){throw o}}};class m{constructor(t){I(this,"functionId","");I(this,"state",{});t?(this.functionId=t,this.read(t)):console.warn("No functionId provided, set it via setFunctionId")}setFunctionId(t){this.functionId=t}_isFunctionId(){if(!this.functionId)throw new Error("functionId is not initialized.")}async read(t){try{let e=t||this.functionId;t||this._isFunctionId();const o=(await l.get(r+e)).data;return this.state=o,o}catch(e){console.log(e);return}}async write(t,e){try{let o=e||this.functionId;e||this._isFunctionId();const d={functionId:o,inputs:t},u=(await l.post(E,d)).data,M=u.data.execution.state;return this.state=M,u}catch(o){console.log(o);return}}async testnet(t=0,e,o,d){try{return(await l.post(y,{contractType:t,initState:e,input:o,contractSrc:d})).data}catch(u){console.log(u);return}}}const T=s.createContext({});function R(f){var v;const t=s.useContext(T),[e,o]=s.useState(f||""),[d,u]=s.useState({}),M=(v=t[e])==null?void 0:v.MEM;if(!t[e]){const i=new m(e);t[e]={MEM:i,loaders:{isReadLoading:null,isWriteLoading:null}}}function w(i,c,a){if(!t[a])return;t[a].loaders[i]=c;const h=new CustomEvent("loaderChanged",{detail:{loaders:t[a].loaders,functionId:a}});window.dispatchEvent(h)}s.useEffect(()=>{e?g(e):console.warn("No functionId provided, set it via setFunctionId")},[e]),s.useEffect(()=>{JSON.stringify(d).length>=750*1048576&&console.warn("State size over 750 KB")},[d]),s.useEffect(()=>{Object.keys(t).length>=10&&console.warn("Instantiated 10 functions -- might decrease performance")},[t]);const _=()=>{if(!e)throw new Error("functionId is not initialized.")},S=async i=>{delete t[i]},g=async i=>{try{let c=i||e;i||_(),w("isReadLoading",!0,c);const a=(await l.get(r+c)).data;return w("isReadLoading",!1,c),u(a),a}catch(c){console.log(c);return}};return{currentFunction:M,setFunctionId:o,destroyFunctionId:S,allFunctions:t,state:d,read:g,write:async(i,c)=>{try{let a=c||e;c||_();const h={functionId:a,inputs:i};w("isWriteLoading",!0,a);const p=(await l.post(E,h)).data;w("isWriteLoading",!1,a);const L=p.data.execution.state;return u(L),p}catch(a){console.log(a);return}},testnet:async(i=0,c,a,h)=>{try{return(await l.post(y,{contractType:i,initState:c,input:a,contractSrc:h})).data}catch(p){console.log(p);return}}}}n.KB=1048576,n.MEMContext=T,n.MEM_URL_READ=r,n.MEM_URL_TESTNET=y,n.MEM_URL_WRITE=E,n.axios=l,n.default=m,n.useMEM=R,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
